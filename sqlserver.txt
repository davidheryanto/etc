# Connect with pypyodbc on python
import pypyodbc as pyodbc
conn = pyodbc.connect(driver='{SQL Server}'
                      , server='sga81109\sqlexpress'
                      , database='handshake'
                      , trusted_connection='yes')
cursor = conn.cursor()
cursor.execute("select top 20 * from person;")
for r in cursor.fetchall():
    print(r)

# Check table exists ANSI compliant way
# http://stackoverflow.com/questions/7887011/how-to-drop-a-table-if-it-exists-in-sql-server
if exists (select * from INFORMATION_SCHEMA.TABLES where TABLE_NAME = 'Scores') drop table Scores;

# Offset and limit
SELECT email FROM emailTable 
WHERE id=3
ORDER BY Id
OFFSET 10 ROWS
FETCH NEXT 10 ROWS ONLY;

# Create foreign key
create table question_bank
(
    question_id uniqueidentifier primary key,
    question_exam_id uniqueidentifier not null,
    question_text varchar(1024) not null,
    question_point_value decimal,
    foreign key ( question_exam_id ) references exams (exam_id)
);

alter table MyTable
add constraint FK_ForeignKeyTable_PrimaryKeyTable FOREIGN KEY ( MyColumn ) references MyOtherTable(PKColumn);

# Add primary key to existing table
ALTER TABLE dbo.YourTable ADD ID INT IDENTITY
# To existing column
ALTER TABLE Persons ADD CONSTRAINT pk_PersonID PRIMARY KEY (P_Id)

# Make column not null
alter table mytable alter column [mycolumn] int not null;

# Substring
SUBSTRING ( expression ,start , length )

# Example of creating FULLTEXT index
CREATE FULLTEXT CATALOG ft AS DEFAULT;

DROP INDEX PP.Person_Seq_Nbr;

ALTER TABLE PP
ALTER COLUMN Person_Seq_Nbr VARCHAR(255) NOT NULL;

ALTER TABLE PP
ADD CONSTRAINT pk_Person_Seq_Nbr PRIMARY KEY(Person_Seq_Nbr);

CREATE FULLTEXT INDEX on PP(Person_Name) 
	KEY INDEX pk_Person_Seq_Nbr
	WITH STOPLIST = SYSTEM;

# FREETEXTTABLE with ranking
# https://msdn.microsoft.com/en-us/library/ms177652.aspx
SELECT TOP 20 PP.Person_Name, KEY_TBL.RANK
FROM PP 
INNER JOIN FREETEXTTABLE(PP, Person_Name, 'anna robinson') AS KEY_TBL
ON PP.Person_Seq_Nbr = KEY_TBL.[KEY]
ORDER BY RANK DESC;