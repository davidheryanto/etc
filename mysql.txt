# Erorr: MySql server has gone away
# http://stackoverflow.com/questions/12425287/mysql-server-has-gone-away-when-importing-large-sql-file
# Modify my.ini
SET GLOBAL max_allowed_packet=1024M;

# Install mysql without root, sudo
# http://superuser.com/questions/209203/how-can-i-install-mysql-on-centos-without-being-root-su
$ cd $MYSQL_HOME
$ vim my.cnf
[server]
user=davidheryanto
basedir=$MYSQL_HOME
datadir=$MYSQL_HOME/data
socket=/tmp/mysql.socket
port=3306
$ ./scripts/mysql_install_db --defaults-file=./my.cnf
$ ./mysqld_safe --defaults-file=./my.cnf

# Initial setup
$ mysql_secure_installation

# Set sql_mode to ansi, more cross platform, eg use ' instead of `
# http://dba.stackexchange.com/questions/23129/benefits-of-using-backtick-in-mysql-queries
SET sql_mode = 'ANSI_QUOTES';

# Simple wordpress setup
# http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/hosting-wordpress.html
mysql -u root -p
create user wordpress_user@localhost identified by 'password';
create database wordpress;
grant all privileges on wordpress.* to wordpress_user@localhost;
flush privileges;

# Select column name
SELECT `COLUMN_NAME` 
FROM `INFORMATION_SCHEMA`.`COLUMNS` 
WHERE `TABLE_SCHEMA`='yourdatabasename' 
    AND `TABLE_NAME`='yourtablename';

# Python driver
# Need to install -devel library first
pip install MySQL-python 
import MySQLdb
connection = MySQLdb.connect(host='localhost', user='root', passwd='mypassword', db='mydatabase')

# Update root password
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('MyNewPass');
FLUSH PRIVILEGES;

# Sqlalchemy example
# Connection string
mysql+mysqldb://<user>:<password>@<host>[:<port>]/<dbname>

engine = create_engine(connection_string)
Session = sessionmaker(bind=engine)
session = Session()

Base = declarative_base()
class User(Base):
    __tablename__ = 'user'
    
    id = Column(Integer, primary_key=True)
    name = Column(String(50))
    password = Column(String(50))
    
    def __repr__(self):
        return '{},{}'.format(self.name,self.password)

Base.metadata.create_all(engine)
user = User(name='david', password='password')
session.add(user)
session.commit()
session.query(User).all()

# Show table info
SHOW CREATE TABLE <table_name>

# Backup database with mysqldump
# http://stackoverflow.com/questions/13484667/downloading-mysql-dump-from-command-line
$ mysqldump -u [uname] -p db_name > db_backup.sql
$ mysqldump -u [uname] -p db_name | gzip > db_backup.sql.gz

# Change buffer pool size to 70% VM memory for better performance (my.cnf)
innodb_buffer_pool_size=1G
# Change from command line
SELECT @@innodb_buffer_pool_size;
SET GLOBAL innodb_buffer_pool_size=4026531840;

# Use SSCursor in python for memory efficient result fetching
# http://stackoverflow.com/questions/1808150/how-to-efficiently-use-mysqldb-sscursor

import MySQLdb.cursors

connection=MySQLdb.connect(
    host="thehost",user="theuser",
    passwd="thepassword",db="thedb",
    cursorclass = MySQLdb.cursors.SSCursor)
cursor=connection.cursor()
cursor.execute(query)
for row in cursor:
    print(row)

# Change buffer pool size, critical for performance
SELECT @@innodb_buffer_pool_size;
SET GLOBAL innodb_buffer_pool_size=4294967296;  # 4GB